<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Shadow Fruit Power System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="app-header">
    <h1>Shadow Fruit Control Panel</h1>
    <p>Calculate shadow power, pick buffs, reanimate corpses, and generate abilities.</p>
  </header>

  <main class="app-main">
    <!-- SECTION: Shadow Input -->
    <section class="card">
      <h2>1. Add a New Shadow</h2>
      <div class="grid-2">
        <div class="form-group">
          <label for="shadow-name">Name / Title</label>
          <input type="text" id="shadow-name" placeholder="Vice Admiral, Kaido, Bandit #3" />
        </div>

        <div class="form-group">
          <label for="raw-might">Raw Might Rating (0–20)</label>
          <input type="number" id="raw-might" min="0" max="20" value="5" />
          <small>Overall strength impression (0 = civilian, 20 = final world boss).</small>
        </div>

        <div class="form-group">
          <label for="proficiency-tier">Proficiency Tier</label>
          <select id="proficiency-tier"></select>
          <small>How skilled/experienced they are.</small>
        </div>

        <div class="form-group">
          <label for="template-tier">Template Tier</label>
          <select id="template-tier"></select>
          <small>Human, Devil Fruit user, advanced fighter, world boss, etc.</small>
        </div>
      </div>

      <div class="shadow-result">
        <button id="btn-calc-shadow" class="btn primary">Calculate Shadow Level</button>
        <div id="shadow-calc-output"></div>
        <button id="btn-add-shadow" class="btn secondary" disabled>Add to My Shadow Collection</button>
      </div>
    </section>

    <!-- SECTION: Shadow Collection -->
    <section class="card">
      <h2>2. My Collected Shadows</h2>
      <div class="summary-row">
        <div>Total Shadow Power (SPU): <span id="total-asp">0</span></div>
        <div>Spent SPU: <span id="spent-asp">0</span></div>
        <div>Available SPU: <span id="available-asp">0</span></div>
      </div>

      <div id="shadow-list-empty" class="empty-state">
        No shadows stored yet. Add one above to start absorbing.
      </div>

      <div id="shadow-list" class="shadow-list"></div>
    </section>

    <!-- SECTION: Buff Selection & Tools -->
    <section class="card">
      <h2>3. Spend Shadow Power on Buffs</h2>
      <p>Select buffs you want to “buy” with your available SPU (Shadow Power Units). You can stack multiple copies; each extra copy gets more expensive.</p>

      <div id="buff-list" class="buff-list"></div>

      <h3>Selected Buffs</h3>
      <div id="selected-buffs" class="selected-buffs"></div>

      <hr class="section-divider" />

      <h3>Custom Buff Creator</h3>
      <p>Create your own buff entries to add to the list.</p>
      <div class="grid-2">
        <div class="form-group">
          <label for="custom-buff-name">Buff Name</label>
          <input type="text" id="custom-buff-name" placeholder="Shadow Fortified Bones" />
        </div>
        <div class="form-group">
          <label for="custom-buff-cost">Base SPU Cost (per first copy)</label>
          <input type="number" id="custom-buff-cost" min="1" value="10" />
        </div>
        <div class="form-group">
          <label for="custom-buff-minAsp">Minimum Total SPU Required</label>
          <input type="number" id="custom-buff-minAsp" min="0" value="0" />
        </div>
        <div class="form-group">
          <label for="custom-buff-desc">Description</label>
          <textarea id="custom-buff-desc" rows="3" placeholder="What does this buff do mechanically? AC, HP, damage, saves, etc."></textarea>
        </div>
      </div>
      <button id="btn-add-custom-buff" class="btn secondary">Add Custom Buff</button>

      <hr class="section-divider" />

      <h3>Shadow DC Helper</h3>
      <p>Quick helper for setting DCs on shadow techniques.</p>
      <div class="grid-2">
        <div class="form-group">
          <label for="dc-shadow-level">Shadow Level (SL)</label>
          <input type="number" id="dc-shadow-level" min="1" max="10" value="5" />
          <small>Use the strongest relevant shadow or your average SL.</small>
        </div>
        <div class="form-group">
          <label for="dc-spell-mod">Spellcasting / Ability Modifier</label>
          <input type="number" id="dc-spell-mod" min="-5" max="10" value="4" />
          <small>For example, +4 if your casting stat is 18.</small>
        </div>
      </div>

      <div class="form-group">
        <label for="dc-prof">Proficiency Bonus (optional)</label>
        <input type="number" id="dc-prof" min="0" max="10" value="3" />
        <small>Standard D&D style: DC = 8 + mod + prof + shadow bonus.</small>
      </div>

      <button id="btn-calc-dc" class="btn secondary">Calculate Suggested DC</button>
      <div id="dc-output" class="status-text"></div>
    </section>

    <!-- SECTION: Reanimation -->
    <section class="card">
      <h2>4. Reanimate a Corpse</h2>
      <div class="grid-2">
        <div class="form-group">
          <label for="corpse-name">Corpse Name / Type</label>
          <input type="text" id="corpse-name" placeholder="Ogre corpse, Ancient dragon bones, Giant warrior" />
        </div>

        <div class="form-group">
          <label for="corpse-durability">Corpse Durability Tier (1–10)</label>
          <input type="number" id="corpse-durability" min="1" max="10" value="5" />
          <small>How tough the physical body is.</small>
        </div>
      </div>

      <div class="form-group">
        <label for="corpse-shadow-mode">Which Shadows Power It?</label>
        <select id="corpse-shadow-mode">
          <option value="active">Use all active shadows</option>
          <option value="all">Use all stored shadows</option>
          <option value="custom">Use selected shadows below</option>
        </select>
      </div>

      <div class="form-group">
        <label for="corpse-shadow-custom">Custom Shadow Selection</label>
        <select id="corpse-shadow-custom" multiple size="4"></select>
        <small>Select specific shadows when “Use selected shadows below” is chosen.</small>
      </div>

      <button id="btn-generate-reanimation" class="btn primary">Generate Reanimated Stat Block</button>
      <textarea id="reanimation-output" class="output-box editable-output" rows="18"></textarea>
    </section>

    <!-- SECTION: AI Ability Generator -->
    <section class="card">
      <h2>5. Ask the Shadows (AI)</h2>
      <p>
        Send your current shadow pool, buffs, and a theme to AI to generate named attacks,
        unique traits, and transformation ideas.
      </p>

      <div class="form-group">
        <label for="ai-notes">Extra Notes / Theme</label>
        <textarea id="ai-notes" rows="4" placeholder="Example: Aggressive melee bruiser, terrifying battlefield controller, focuses on fear and grapples."></textarea>
      </div>

      <div class="button-row">
        <button id="btn-ai-generate" class="btn primary">Generate Abilities with AI</button>
        <button id="btn-ai-reroll" class="btn secondary">Reroll Abilities</button>
      </div>

      <div id="ai-status" class="status-text"></div>
      <textarea id="ai-output" class="output-box editable-output" rows="18"></textarea>
    </section>

    <!-- SECTION: Summary & Print -->
    <section class="card">
      <h2>6. Current Summary</h2>
      <p>At-a-glance summary of your current shadows, buffs, and named techniques. You can edit this text and print a quick reference.</p>
      <textarea id="summary-output" class="output-box editable-output" rows="18"></textarea>

      <div class="button-row">
        <button id="btn-force-save" class="btn secondary">Save Now</button>
        <button id="btn-print-summary" class="btn secondary">Print Quick Reference</button>
        <button id="btn-reset-all" class="btn danger">Reset All Data</button>
      </div>
      <small>Data is automatically saved in your browser (localStorage).</small>
    </section>
  </main>

  <footer class="app-footer">
    <p>Shadow Fruit System • Built for your One Piece D&D campaign</p>
  </footer>

  <script src="script.js" defer></script>
</body>
</html>
